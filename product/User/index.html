<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI User - sings.ai</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Inter 字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0D0D1B;
            color: #E0E0E0;
        }
        .gradient-text {
            background: linear-gradient(90deg, #8A2BE2, #4F46E5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        .glass-morphism {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .lang-button {
            background-color: rgba(255, 255, 255, 0.1);
            color: #d1d5db;
            font-weight: 500;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }
        .lang-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }
        .lang-dropdown-menu {
            background: #1f2937; /* gray-800 */
            border: 1px solid #374151; /* gray-700 */
        }
        .lang-dropdown-menu a:hover {
            background-color: #374151; /* gray-700 */
        }
        .user-card {
            background-color: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        .user-card:hover {
            transform: translateY(-5px);
            border-color: rgba(138, 43, 226, 0.5);
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.2);
        }
        .btn-secondary {
            background-color: rgba(255, 255, 255, 0.1);
            color: #d1d5db;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: background-color 0.3s;
        }
        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.15);
        }
        .btn-primary {
            background-image: linear-gradient(to right, #8A2BE2, #4F46E5);
            color: white;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            transition: opacity 0.3s;
        }
        .btn-primary:hover {
            opacity: 0.9;
        }
        .input-text {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #E0E0E0;
            border-radius: 8px;
            padding: 0.75rem 1.25rem;
            transition: border-color 0.3s;
        }
        .input-text:focus {
            outline: none;
            border-color: #4F46E5;
        }
        /* 旋转加载动画 */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* 模态框样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal-content {
            background-color: #1f2937;
            padding: 2rem;
            border-radius: 12px;
            max-width: 90%;
            width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Navigation Bar -->
    <nav class="fixed top-0 left-0 right-0 z-50 p-4">
        <div class="container mx-auto glass-morphism rounded-xl p-2 px-4 flex justify-between items-center">
            <!-- 左侧: 返回主页按钮和Logo -->
            <div class="flex items-center space-x-4">
                <a href="https://sings.ai/#" class="flex items-center text-gray-300 hover:text-white transition-colors">
                    <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    <span data-key="navHome">返回主页</span>
                </a>
                <a href="https://sings.ai/#" class="text-xl font-bold text-white">sings.ai</a>
            </div>

            <!-- 右侧: 语言切换下拉菜单 -->
            <div class="relative" id="lang-switcher-container">
                <button id="lang-switcher-button" class="lang-button flex items-center space-x-2">
                    <svg class="w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.004 9.004 0 013 12c0-1.615.42-3.119 1.157-4.418" />
                    </svg>
                    <span id="current-lang-text" data-key="langCurrent" class="text-sm">简体中文</span>
                    <svg class="w-4 h-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                    </svg>
                </button>
                <div id="lang-dropdown" class="lang-dropdown-menu absolute top-full right-0 mt-2 w-36 rounded-lg shadow-lg hidden z-10">
                    <a href="#" class="block px-4 py-2 text-sm text-gray-300" data-lang="zh" data-key="langZh">简体中文</a>
                    <a href="#" class="block px-4 py-2 text-sm text-gray-300" data-lang="en" data-key="langEn">English</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 md:p-8 max-w-7xl px-4 pt-32 md:pt-40 pb-16 md:pb-24">
        <!-- 页面标题 -->
        <header class="text-center my-10">
            <h1 class="text-3xl md:text-5xl font-extrabold text-white">
                <span class="gradient-text" data-key="mainTitle">AI User</span>
            </h1>
            <p class="mt-3 text-lg text-gray-400" data-key="mainSubtitle">即刻访问您的专属 AI 用户池，获得源源不断的灵感与洞察。</p>
        </header>

        <!-- 用户生成输入和按钮 -->
        <div class="flex flex-col sm:flex-row gap-4 mb-10 items-center justify-center">
            <!-- 输入框现在用于输入生成条件 -->
            <input type="text" id="generate-input" placeholder="输入您的用户画像样本条件..." class="input-text w-full sm:w-1/2 md:w-1/3">
            <button id="generate-btn" class="btn-primary w-full sm:w-auto flex items-center justify-center gap-2">
                <span id="generate-btn-text" data-key="generateBtn">生成新用户</span>
                <div id="generate-spinner" class="hidden spinner w-5 h-5"></div>
            </button>
        </div>

        <!-- 用户档案网格 -->
        <div id="user-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- 用户卡片将由 JavaScript 插入此处 -->
        </div>

        <!-- 显示更多/收起按钮容器 -->
        <div id="toggle-users-container" class="text-center mt-10">
            <!-- 按钮将由 JavaScript 插入此处 -->
        </div>
    </div>

    <!-- 用户生成详情模态框 -->
    <div id="generation-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

            <div id="modal-content-container">
                <!-- 模态框内容将在这里动态加载 -->
            </div>
        </div>
    </div>

    <script>
        // --- AI 用户模拟数据 ---
        let aiUsers = [
            { name: '王伟', age: 32, city: '上海', family: '已婚，一子', occupation: '软件工程师', hobbies: ['编程', '篮球', '看电影'], personality: '逻辑清晰，善于分析', mbti: 'INTJ' },
            { name: '李静', age: 28, city: '北京', family: '单身', occupation: '市场营销经理', hobbies: ['旅行', '摄影', '瑜伽'], personality: '外向开朗，富有创意', mbti: 'ENFP' },
            { name: '张敏', age: 35, city: '深圳', family: '已婚，无子女', occupation: '金融分析师', hobbies: ['阅读', '投资', '徒步'], personality: '严谨细致，目标导向', mbti: 'ISTJ' },
            { name: '刘洋', city: '广州', age: 24, family: '恋爱中', occupation: '平面设计师', hobbies: ['绘画', '听音乐', '美食'], personality: '感性浪漫，追求美感', mbti: 'ISFP' },
            { name: '陈琳', age: 30, city: '杭州', family: '单身', occupation: '自由职业者', hobbies: ['写作', '咖啡', '逛街'], personality: '独立自主，随性而为', mbti: 'INFP' },
            { name: '黄勇', age: 41, city: '成都', family: '已婚，一女', occupation: '厨师', hobbies: ['烹饪', '园艺', '钓鱼'], personality: '踏实可靠，热爱生活', mbti: 'ISFJ' },
            { name: '赵文', age: 26, city: '重庆', family: '单身', occupation: '游戏开发者', hobbies: ['电子游戏', '动漫', '健身'], personality: '充满激情，喜欢挑战', mbti: 'ENTP' },
            { name: '吴杰', age: 38, city: '武汉', family: '已婚，龙凤胎', occupation: '医生', hobbies: ['打羽毛球', '带孩子', '听相声'], personality: '细心耐心，责任感强', mbti: 'ESFJ' },
            { name: '周秀英', age: 45, city: '苏州', family: '离异，与子同住', occupation: '教师', hobbies: ['书法', '茶道', '历史剧'], personality: '温和沉稳，知识渊博', mbti: 'INFJ' }
        ];

        // --- 语言翻译 ---
        const translations = {
            zh: {
                pageTitle: 'AI User - sings.ai',
                navHome: '返回主页',
                langCurrent: '简体中文',
                langZh: '简体中文',
                langEn: 'English',
                mainTitle: 'AI User',
                mainSubtitle: '即刻访问您的专属 AI 用户池，获得源源不断的灵感与洞察。',
                inputPlaceholder: '输入您的用户画像样本条件...',
                cityLabel: '城市',
                familyLabel: '家庭结构',
                occupationLabel: '职业',
                hobbiesLabel: '爱好',
                personalityLabel: '性格',
                mbtiLabel: 'MBTI',
                showMoreBtn: '显示更多',
                showLessBtn: '收起',
                generateBtn: '生成新用户',
                generating: '正在生成...',
                generationTitle: '正在生成新用户画像...',
                generationAttribution: '此用户画像由<strong class="font-bold">“SiliconFlow”</strong>大模型生成。该系统依托于<strong class="font-bold">“多维社会网络图谱”</strong>和<strong class="font-bold">“实时行为洞察引擎”</strong>，利用先进的<strong class="font-bold">情景化推演算法</strong>，从庞大的<strong class="font-bold">中国互联网用户行为大数据</strong>中提取并重构用户特征。其核心能力在于<strong class="font-bold">动态模拟</strong>，能根据指定条件（如年龄、职业、偏好）生成高度逼真、逻辑自洽的虚拟用户，旨在为市场细分、产品迭代和用户体验设计提供精准且可控的仿真样本。',
                generatedUserTitle: '新用户档案已生成',
                closeModal: '关闭'
            },
            en: {
                pageTitle: 'AI User - sings.ai',
                navHome: 'Back to Home',
                langCurrent: 'English',
                langZh: '简体中文',
                langEn: 'English',
                mainTitle: 'AI User',
                mainSubtitle: 'Instantly access your exclusive AI user pool for continuous inspiration and insights.',
                inputPlaceholder: 'Enter your user persona sample conditions...',
                cityLabel: 'City',
                familyLabel: 'Family Structure',
                occupationLabel: 'Occupation',
                hobbiesLabel: 'Hobbies',
                personalityLabel: 'Personality',
                mbtiLabel: 'MBTI',
                showMoreBtn: 'Show More',
                showLessBtn: 'Show Less',
                generateBtn: 'Generate New Users',
                generating: 'Generating...',
                generationTitle: 'Generating New User Persona...',
                generationAttribution: 'This user persona was generated by the <strong>"SiliconFlow"</strong> large model. It is powered by a <strong>"Multi-Dimensional Social Network Graph"</strong> and a <strong>"Real-Time Behavioral Insight Engine"</strong>. Leveraging an advanced <strong>situational deduction algorithm</strong>, it extracts and reconstructs user characteristics from a vast <strong>Chinese Internet User Behavior Big Data Set</strong>. Its core capability lies in <strong>dynamic simulation</strong>, generating highly realistic and logically consistent virtual users based on specified conditions (e.g., age, occupation, preferences), aiming to provide precise and controllable simulated samples for market segmentation, product iteration, and user experience design.',
                generatedUserTitle: 'New User Persona Generated',
                closeModal: 'Close'
            }
        };

        // --- 全局状态 ---
        let currentLanguage = 'zh';
        let isExpanded = false;

        // --- 函数 ---
        /**
         * 设置页面的语言
         */
        function setLanguage(lang) {
            currentLanguage = lang;
            document.documentElement.lang = lang;
            
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.dataset.key;
                if (translations[lang][key]) {
                    el.innerHTML = translations[lang][key];
                }
            });

            document.getElementById('generate-input').placeholder = translations[lang].inputPlaceholder;
            document.title = translations[lang].pageTitle;
            renderUserGrid();
        }

        /**
         * 渲染用户卡片网格
         */
        function renderUserGrid() {
            const grid = document.getElementById('user-grid');
            const toggleContainer = document.getElementById('toggle-users-container');
            grid.innerHTML = '';
            toggleContainer.innerHTML = '';
            
            const langDict = translations[currentLanguage];
            const usersToDisplay = aiUsers;
            const usersToDisplayCount = isExpanded ? usersToDisplay.length : 9;
            const usersToRender = usersToDisplay.slice(0, usersToDisplayCount);

            usersToRender.forEach(user => {
                const card = document.createElement('div');
                card.className = 'user-card rounded-xl p-5 flex flex-col';
                const hobbiesString = user.hobbies ? user.hobbies.join('，') : '无';

                card.innerHTML = `
                    <div class="flex items-center mb-4">
                        <img src="https://api.dicebear.com/8.x/lorelei/svg?seed=${encodeURIComponent(user.name)}" alt="${user.name}的头像" class="w-12 h-12 rounded-full mr-4 bg-gray-600">
                        <h3 class="text-lg font-bold text-white">${user.name}</h3>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400"><strong class="font-medium text-gray-300">${langDict.cityLabel}:</strong> ${user.city}</p>
                        <p class="text-sm text-gray-400 mt-1"><strong class="font-medium text-gray-300">${langDict.familyLabel}:</strong> ${user.family}</p>
                        <p class="text-sm text-gray-400 mt-1"><strong class="font-medium text-gray-300">${langDict.occupationLabel}:</strong> ${user.occupation}</p>
                        <p class="text-sm text-gray-400 mt-1"><strong class="font-medium text-gray-300">${langDict.hobbiesLabel}:</strong> ${hobbiesString}</p>
                        <p class="text-sm text-gray-400 mt-1"><strong class="font-medium text-gray-300">${langDict.personalityLabel}:</strong> ${user.personality} (${user.mbti})</p>
                    </div>
                `;
                grid.appendChild(card);
            });

            if (usersToDisplay.length > 9) {
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'btn-secondary';
                toggleBtn.textContent = isExpanded ? langDict.showLessBtn : langDict.showMoreBtn;
                
                toggleBtn.onclick = () => {
                    isExpanded = !isExpanded;
                    renderUserGrid();
                };
                toggleContainer.appendChild(toggleBtn);
            }
        }
        
        /**
         * 使用 SiliconFlow API 生成新的 AI 用户, 包含对用户输入的自动纠正逻辑
         */
        async function generateUsers() {
            const generateInput = document.getElementById('generate-input');
            const generateBtn = document.getElementById('generate-btn');
            const generateBtnText = document.getElementById('generate-btn-text');
            const generateSpinner = document.getElementById('generate-spinner');
            const modal = document.getElementById('generation-modal');
            const modalContent = document.getElementById('modal-content-container');

            generateBtn.disabled = true;
            generateBtnText.textContent = translations[currentLanguage].generating;
            generateSpinner.classList.remove('hidden');

            modal.classList.remove('hidden');
            modalContent.innerHTML = `
                <div class="flex flex-col items-center justify-center py-10">
                    <div class="spinner w-12 h-12 mb-4"></div>
                    <h2 class="text-xl font-bold text-white">${translations[currentLanguage].generationTitle}</h2>
                </div>
            `;

            // 核心指令，定义了 JSON 结构和基本要求
            const basePrompt = `
                请生成1个中国虚拟用户的档案，以 JSON 对象格式返回，不要包含任何 markdown 标记。这个档案应该尽可能详细和逼真，用于市场研究和用户画像分析。
                档案应包含以下字段：
                - name (姓名): 一个常见的中文姓名。
                - age (年龄): 20到50岁之间的随机整数。
                - city (城市): 一个常见的中国城市名。
                - family (家庭结构): 一个简短的描述，如“单身”、“已婚，一子”、“恋爱中”。
                - occupation (职业): 一个常见的职业，如“软件工程师”、“教师”、“设计师”。
                - hobbies (爱好): 一个字符串数组，列出3-4个与职业和性格相符的爱好。
                - personality (性格): 一个简短的性格描述，如“逻辑清晰”、“外向开朗”。
                - mbti (MBTI): 一个有效的MBTI人格类型，如“INTJ”、“ESFP”等。
            `;

            const userPrompt = generateInput.value.trim();
            let fullPrompt;

            if (userPrompt) {
                // 如果用户提供了输入，构建一个更鲁棒的、带有“自动纠正”能力的指令
                fullPrompt = `
你是一个用户画像生成专家。你的任务是根据用户提供的条件，生成一个符合要求的、详细的中国用户画像JSON。
用户的输入可能不清晰或不完整。请遵循以下原则处理：
1.  **核心任务优先**: 无论用户输入什么，你的首要任务是成功生成一个符合下面定义的完整JSON对象。
2.  **智能解读**: 如果用户输入不明确（例如只输入“设计师”），请围绕这个核心词汇，合理地、创造性地补全其他所有字段。
3.  **忽略无关项**: 如果用户输入与生成中国用户画像无关或矛盾（例如“给我一只猫”、“生成一个美国人”），请忽略这些无效指令，专注于生成一个随机但合理的中国用户画像。
4.  **绝不中断**: 绝对不要因为用户输入奇怪就放弃生成或返回错误。你的职责就是确保总能输出一个有效的JSON。

---
用户提供的生成条件是：“${userPrompt}”
---

${basePrompt}
                `;
            } else {
                // 如果用户没有输入，直接使用核心指令
                fullPrompt = basePrompt;
            }

            // --- SiliconFlow API 配置 ---
            const apiKey = "sk-xifmrwnarxegowpdpwjmbpiodhjawjtacbkgtkoygpgszhec";
            const apiUrl = "https://api.siliconflow.cn/v1/chat/completions";
            
            const payload = {
                // 更换为另一个可用的模型
                model: "alibaba/Qwen2-7B-Instruct",
                messages: [
                    {
                        role: "user",
                        content: fullPrompt
                    }
                ],
                stream: false,
                response_format: { "type": "json_object" }
            };
            
            let attempts = 0;
            const maxAttempts = 3;
            let success = false;
            let newUser = null;

            while (attempts < maxAttempts && !success) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        const errorBody = await response.json();
                        console.error('API Error Body:', errorBody);
                        throw new Error(`API Error: ${response.status} ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    
                    if (result.choices && result.choices.length > 0 && result.choices[0].message) {
                        const jsonString = result.choices[0].message.content;
                        try {
                            newUser = JSON.parse(jsonString);
                            success = true;
                        } catch (parseError) {
                             console.error('JSON parsing error:', parseError, 'Received string:', jsonString);
                        }
                    } else {
                        console.error('API response format is incorrect:', result);
                    }
                } catch (error) {
                    console.error(`Attempt ${attempts + 1} failed:`, error);
                    if (attempts < maxAttempts - 1) {
                        await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempts) * 1000));
                    }
                }
                attempts++;
            }

            if (success && newUser) {
                aiUsers.unshift(newUser);
                generateInput.value = '';
                renderUserGrid();

                const hobbiesString = newUser.hobbies ? newUser.hobbies.join('，') : '无';
                modalContent.innerHTML = `
                    <h2 class="text-xl md:text-2xl font-bold text-white mb-4">${translations[currentLanguage].generatedUserTitle}</h2>
                    <div class="flex items-center mb-4">
                        <img src="https://api.dicebear.com/8.x/lorelei/svg?seed=${encodeURIComponent(newUser.name)}" alt="${newUser.name}的头像" class="w-16 h-16 rounded-full mr-4 bg-gray-600">
                        <div>
                            <h3 class="text-2xl font-bold text-white">${newUser.name}</h3>
                            <p class="text-sm text-gray-400 mt-1">${newUser.age} 岁</p>
                        </div>
                    </div>
                    <div class="space-y-1">
                        <p class="text-sm text-gray-400"><strong class="font-medium text-gray-300">${translations[currentLanguage].cityLabel}:</strong> ${newUser.city}</p>
                        <p class="text-sm text-gray-400"><strong class="font-medium text-gray-300">${translations[currentLanguage].familyLabel}:</strong> ${newUser.family}</p>
                        <p class="text-sm text-gray-400"><strong class="font-medium text-gray-300">${translations[currentLanguage].occupationLabel}:</strong> ${newUser.occupation}</p>
                        <p class="text-sm text-gray-400"><strong class="font-medium text-gray-300">${translations[currentLanguage].hobbiesLabel}:</strong> ${hobbiesString}</p>
                        <p class="text-sm text-gray-400"><strong class="font-medium text-gray-300">${translations[currentLanguage].personalityLabel}:</strong> ${newUser.personality}</p>
                        <p class="text-sm text-gray-400"><strong class="font-medium text-gray-300">${translations[currentLanguage].mbtiLabel}:</strong> ${newUser.mbti}</p>
                    </div>
                    <p class="text-xs text-gray-400 mt-6 leading-relaxed">${translations[currentLanguage].generationAttribution}</p>
                `;
            } else {
                modalContent.innerHTML = `<p class="text-center text-red-400">生成用户时出错。请检查浏览器控制台获取详情或更换生成条件后重试。</p>`;
            }

            generateBtn.disabled = false;
            generateBtnText.textContent = translations[currentLanguage].generateBtn;
            generateSpinner.classList.add('hidden');
        }

        // --- 初始化 ---
        document.addEventListener('DOMContentLoaded', () => {
            const langSwitcherButton = document.getElementById('lang-switcher-button');
            const langDropdown = document.getElementById('lang-dropdown');
            const generateBtn = document.getElementById('generate-btn');
            const modal = document.getElementById('generation-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');

            langSwitcherButton.addEventListener('click', (event) => {
                event.stopPropagation();
                langDropdown.classList.toggle('hidden');
            });

            document.addEventListener('click', (event) => {
                if (!langSwitcherButton.contains(event.target)) {
                    langDropdown.classList.add('hidden');
                }
            });

            langDropdown.addEventListener('click', (event) => {
                const target = event.target.closest('a');
                if (target && target.dataset.lang) {
                    event.preventDefault();
                    setLanguage(target.dataset.lang);
                    langDropdown.classList.add('hidden');
                }
            });
            
            generateBtn.addEventListener('click', generateUsers);

            closeModalBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });
            modal.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.classList.add('hidden');
                }
            });

            setLanguage(currentLanguage);
        });
    </script>
</body>
</html>
