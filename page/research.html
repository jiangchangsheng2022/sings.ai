<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sings.AI - Deep Research (专家助手)</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
        /* 继承自您网站的自定义全局样式 */
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
            background-color: #050608;
            color: #E2E8F0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            /* subtle grid background */
            background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
        }
        .glass-morphism {
            background: rgba(17, 24, 39, 0.5); /* 更深的背景以提高对比度 */
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(37, 99, 235, 0.6);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(37, 99, 235, 0.8);
        }
        /* 打字机光标动画 */
        .typing-cursor::after {
            content: '▋';
            animation: blink 1s step-end infinite;
            color: #60A5FA;
            margin-left: 2px;
        }
        @keyframes blink { 50% { opacity: 0; } }
        /* 加载中旋转动画 */
        .spinning {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        /* 预设指令按钮样式 */
        .preset-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease-in-out;
        }
        .preset-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <!-- Header -->
    <header class="p-4">
        <div class="container mx-auto flex justify-between items-center">
            <a href="#" class="flex items-center text-2xl font-bold text-white"><span class="text-blue-400">Sings</span><span>.AI Chat</span></a>
            <div class="flex items-center space-x-4">
                <a href="#" class="text-gray-300 hover:text-white transition-colors text-sm font-medium">返回官网</a>
            </div>
        </div>
    </header>

    <!-- Chat UI Container -->
    <main class="flex-grow flex flex-col container mx-auto px-4 pb-4">
        <div class="flex-grow flex flex-col glass-morphism rounded-xl overflow-hidden">
            <!-- Chat Messages Area -->
            <div id="chat-messages" class="flex-grow p-6 space-y-6 overflow-y-auto">
                <!-- 欢迎消息 -->
                <div id="initial-message-container">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-500/20 border border-blue-500 overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1573497019940-1c28c88b4f3e?q=80&w=400&auto=format&fit=crop" alt="Deep Research AI Assistant Avatar" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-grow bg-gray-800/50 rounded-lg p-4 max-w-3xl">
                            <p class="font-semibold text-blue-300 mb-1">Deep Research</p>
                            <p class="text-gray-300">您好！我是您的专属研究助理“Deep Research”。很高兴能与您合作，我们现在从哪里开始呢？</p>
                        </div>
                    </div>
                    <!-- Preset Prompts -->
                    <div id="preset-prompts" class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-6 max-w-3xl ml-auto mr-auto md:ml-14">
                        <button class="preset-btn text-left p-4 rounded-lg flex items-center gap-4">
                            <i class="ph ph-note-pencil text-2xl text-blue-300"></i>
                            <div>
                                <h4 class="font-semibold text-white">草拟研究计划</h4>
                                <p class="text-sm text-gray-400">为新产品功能探索用户需求</p>
                            </div>
                        </button>
                        <button class="preset-btn text-left p-4 rounded-lg flex items-center gap-4">
                             <i class="ph ph-microphone-stage text-2xl text-blue-300"></i>
                            <div>
                                <h4 class="font-semibold text-white">设计访谈提纲</h4>
                                <p class="text-sm text-gray-400">针对现有产品的用户体验</p>
                            </div>
                        </button>
                        <button class="preset-btn text-left p-4 rounded-lg flex items-center gap-4">
                             <i class="ph ph-list-checks text-2xl text-blue-300"></i>
                            <div>
                                <h4 class="font-semibold text-white">创建调查问卷</h4>
                                <p class="text-sm text-gray-400">评估用户对新定价方案的看法</p>
                            </div>
                        </button>
                        <button class="preset-btn text-left p-4 rounded-lg flex items-center gap-4">
                             <i class="ph ph-chart-line text-2xl text-blue-300"></i>
                            <div>
                                <h4 class="font-semibold text-white">分析竞争对手</h4>
                                <p class="text-sm text-gray-400">对比分析2-3个主要竞品</p>
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Typing Indicator -->
            <div id="typing-indicator" class="hidden p-6 pt-0">
                 <div class="flex items-start gap-4">
                    <div class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-500/20 border border-blue-500 overflow-hidden">
                        <img src="https://images.unsplash.com/photo-1573497019940-1c28c88b4f3e?q=80&w=400&auto=format&fit=crop" alt="Deep Research AI Assistant Avatar" class="w-full h-full object-cover">
                    </div>
                    <div class="flex-grow bg-gray-800/50 rounded-lg p-4 max-w-3xl">
                        <p class="font-semibold text-blue-300 mb-1">Deep Research</p>
                        <div class="flex items-center space-x-2 text-gray-400">
                           <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse" style="animation-delay: 0s;"></div>
                           <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                           <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-4 border-t border-gray-700/50">
                <div class="relative">
                    <textarea id="chat-input" class="w-full bg-gray-800/50 border border-gray-700 rounded-lg py-3 pr-28 pl-5 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 resize-none" placeholder="请描述您的研究课题或输入指令..." rows="1"></textarea>
                    <button id="optimize-button" class="absolute right-[5.5rem] top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center text-gray-400 hover:text-blue-400 rounded-lg transition-colors duration-300 disabled:cursor-not-allowed disabled:opacity-50" title="✨ 优化表达">
                        <i id="optimize-icon" class="ph ph-sparkle text-xl"></i>
                    </button>
                    <button id="send-button" class="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center bg-blue-600 hover:bg-blue-500 rounded-lg transition-colors duration-300 disabled:bg-gray-600 disabled:cursor-not-allowed">
                        <i class="ph ph-paper-plane-tilt text-xl text-white"></i>
                    </button>
                </div>
                 <div class="flex justify-between items-center mt-2">
                    <div class="flex items-center gap-4">
                        <button id="clear-button" class="text-xs text-gray-500 hover:text-gray-300 transition-colors flex items-center gap-1">
                            <i class="ph ph-trash"></i>
                            <span>清除对话</span>
                        </button>
                         <button id="summarize-button" class="text-xs text-gray-500 hover:text-gray-300 transition-colors flex items-center gap-1 disabled:cursor-not-allowed disabled:opacity-50">
                            <i class="ph ph-sparkle"></i>
                            <span id="summarize-text">生成研究摘要</span>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500">核心模型: Gemini Flash</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Element References ---
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-button');
            const typingIndicator = document.getElementById('typing-indicator');
            const clearButton = document.getElementById('clear-button');
            const optimizeButton = document.getElementById('optimize-button');
            const optimizeIcon = document.getElementById('optimize-icon');
            const summarizeButton = document.getElementById('summarize-button');
            const summarizeText = document.getElementById('summarize-text');
            const initialMessageContainer = document.getElementById('initial-message-container');
            const presetPrompts = document.getElementById('preset-prompts');

            // --- API Configuration ---
            const GEMINI_API_KEY = "AIzaSyAazWjGX4uXKXR0mOO7oB6__EgDKTrYMog";
            const GEMINI_MODEL = 'gemini-2.5-flash-preview-05-20';
            const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;
            
            // --- System Instruction ---
            const SYSTEM_INSTRUCTION = {
                role: "system",
                parts: [{ text: "角色与目标 (Role and Goal)\n你将扮演我的专属AI研究助理，名为 “Deep Research”。你的核心定位是成为一名兼具用户研究（微观产品层面）与市场研究（宏观战略层面）双重能力的专家级顾问和高效执行伙伴。你的首要目标是协助我——一名专业的用户与市场研究员——精准、深入、高效地完成从研究规划到成果汇报的全流程工作，并提供具有战略价值的洞察和建议。\n\n核心能力与知识库 (Core Competencies & Knowledge Base)\n你的所有能力和知识都严格基于以下专业职责描述。在与我互动时，你必须始终遵循这些框架：\n\n1. 用户研究 (User Research) - 聚焦具体产品与用户体验\n需求沟通与研究规划: 你能协助我将模糊的业务问题拆解为清晰、可执行的研究课题。当我提出一个研究方向时（如“探索新功能的接受度”），你能主动提出建议的研究方法组合（如可用性测试、深度访谈、问卷调查、A/B测试等），并帮我起草包含研究目标、研究方法、参与者标准、时间规划的详细研究计划初稿。\n用户招募与筛选: 你能根据我定义的目标用户画像，帮我设计逻辑严谨、高效的筛选问卷，以确保招募到的参与者具有代表性。\n执行研究与数据收集: 你是我的“陪练”，可以帮我撰写深度访谈提纲、可用性测试任务脚本、焦点小组讨论指南以及大规模定量问卷的题目。在数据收集阶段，你能帮我整理和初步标记原始数据（如访谈记录）。\n数据分析与洞察提炼: 你擅长处理定性与定量数据。对于访谈录音、用户行为录像等定性数据，你能协助我进行内容编码、主题归纳，并提炼关键发现（Key Findings）和洞察（Insights）。对于定量数据，你能提出恰当的统计分析建议，并解读数据背后的规律。\n撰写报告与成果沟通: 你是我的报告撰写助理。你能将零散的发现组织成有说服力的故事线，帮我起草研究报告的各个章节。你尤其擅长将研究成果转化为用户画像 (Persona)、体验地图 (Experience Map)、故事版 (Storyboard) 等可视化、易于理解的形式，以确保研究价值能被跨职能团队有效吸收。\n\n2. 市场研究 (Market Research) - 聚焦宏观格局与商业机会\n行业监控与趋势分析: 你能作为一个高效的信息处理器，根据我的指令，快速搜集并总结特定行业的市场规模、增长率、主要竞争对手动态、新兴技术、消费者趋势以及相关的宏观经济政策。\n研究项目设计与管理: 当面临战略性问题时（如“评估新市场的进入可行性”），你能协助我设计整合性的研究方案，该方案可能包含案头研究（二手资料分析）、定性座谈会、大规模抽样调查等。你还能帮我起草与外部调研机构沟通的需求文档。\n数据采集与分析: 你能帮我分析各类二手数据（如政府统计报告、行业协会数据、上市公司财报），并从中提取关键信息。同时，你精通SWOT分析、PEST分析、波特五力模型等战略分析框架，能将数据融入其中进行综合评估。\n撰写战略性报告: 你的报告产出更具战略高度。你能协助我撰写包含市场细分、目标人群画像、竞争格局评估、品牌健康度追踪、市场进入策略建议等内容的商业报告。报告的语言风格和逻辑结构应直接面向企业高层管理者。\n跨部门协作与咨询: 你能站在我的角度，思考如何将市场洞察有效地传递给市场部、销售部和战略部。例如，为营销活动策划提供消费者洞察，或为销售团队评估市场潜力。\n\n互动与协作风格 (Interaction & Collaboration Style)\n主动性 (Proactive): 当我提出一个问题时，你不会只被动回答。你会像一个真正的同事一样，提出追问以廓清背景，甚至主动提供多种备选方案或指出潜在风险。\n结构化 (Structured): 你的回答总是条理清晰、逻辑严谨。你会频繁使用标题、列表、表格等形式，让复杂信息一目了然。\n数据驱动 (Data-Driven): 你所有的结论和建议都必须基于逻辑和（模拟的）数据证据。你会经常提醒我“要验证这个假设，我们需要收集...数据”。\n多格式输出 (Versatile Formats): 你能根据我的要求，灵活切换输出格式，无论是正式的报告文本、PPT要点、访谈脚本，还是简单的数据表格。"}]
            };

            // --- Conversation State ---
            let conversationHistory = [];

            // --- Function to add a message to the UI ---
            const addMessage = (sender, message, type = 'chat') => {
                const messageElement = document.createElement('div');
                messageElement.classList.add('flex', 'items-start', 'gap-4');

                let iconHtml, senderName, messageBg, nameColor, avatarBg, avatarBorder;

                if (sender === 'user') {
                    iconHtml = `<i class="ph ph-user text-xl text-gray-300"></i>`;
                    senderName = '您';
                    messageBg = 'bg-gray-700/50';
                    nameColor = 'text-gray-300';
                    avatarBg = 'bg-gray-600/30';
                    avatarBorder = 'border-gray-600';
                    messageElement.classList.add('justify-end');
                } else if (type === 'summary') {
                    iconHtml = `<i class="ph ph-file-text text-xl text-purple-300"></i>`;
                    senderName = '研究摘要';
                    messageBg = 'bg-purple-900/20';
                    nameColor = 'text-purple-300';
                    avatarBg = 'bg-purple-500/20';
                    avatarBorder = 'border-purple-500';
                } else { // AI Assistant
                    iconHtml = `<img src="https://images.unsplash.com/photo-1573497019940-1c28c88b4f3e?q=80&w=400&auto=format&fit=crop" alt="Deep Research AI Assistant Avatar" class="w-full h-full object-cover">`;
                    senderName = 'Deep Research';
                    messageBg = 'bg-gray-800/50';
                    nameColor = 'text-blue-300';
                    avatarBg = 'bg-blue-500/20';
                    avatarBorder = 'border-blue-500';
                }

                const messageContent = `
                    <div class="flex-shrink-0 w-10 h-10 rounded-full ${avatarBg} flex items-center justify-center border ${avatarBorder} overflow-hidden">
                        ${iconHtml}
                    </div>
                    <div class="flex-grow ${messageBg} rounded-lg p-4 max-w-3xl">
                        <p class="font-semibold ${nameColor} mb-1">${senderName}</p>
                        <div class="text-gray-300 prose prose-invert prose-p:my-0"></div>
                    </div>
                `;
                
                if (sender === 'user') {
                    messageElement.innerHTML = messageContent.split('</div>').reverse().join('</div>');
                } else {
                    messageElement.innerHTML = messageContent;
                }
                
                if (initialMessageContainer) {
                    initialMessageContainer.style.display = 'none';
                }

                chatMessages.appendChild(messageElement);
                const textContainer = messageElement.querySelector('.prose');
                
                if (sender !== 'user' && type === 'chat') {
                    textContainer.classList.add('typing-cursor');
                    let i = 0;
                    const speed = 15;
                    function typeWriter() {
                        if (i < message.length) {
                            textContainer.innerHTML += message.charAt(i);
                            i++;
                            setTimeout(typeWriter, speed);
                        } else {
                            textContainer.classList.remove('typing-cursor');
                        }
                    }
                    typeWriter();
                } else {
                    textContainer.innerHTML = message.replace(/\n/g, '<br>');
                }

                chatMessages.scrollTop = chatMessages.scrollHeight;
            };

            // --- Unified Gemini API Call Function ---
            const callGeminiAPI = async (payload) => {
                try {
                    const response = await fetch(GEMINI_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else if (result.promptFeedback && result.promptFeedback.blockReason) {
                        return `抱歉，您的请求因安全原因被阻止: ${result.promptFeedback.blockReason}`;
                    }
                    else {
                         throw new Error("Invalid response structure from API.");
                    }
                } catch (error) {
                    console.error("Gemini API Error:", error);
                    addMessage('ai', `抱歉，Gemini 功能暂时无法使用: ${error.message}`);
                    return null;
                }
            };
            
            // --- Core Chat Function (Now using Gemini) ---
            const handleSendMessage = async () => {
                const userMessage = chatInput.value.trim();
                if (!userMessage) return;

                addMessage('user', userMessage);
                conversationHistory.push({ role: 'user', parts: [{ text: userMessage }] });

                chatInput.value = '';
                chatInput.style.height = 'auto';
                sendButton.disabled = true;
                typingIndicator.classList.remove('hidden');
                chatMessages.scrollTop = chatMessages.scrollHeight;

                const payload = {
                    contents: conversationHistory,
                    systemInstruction: SYSTEM_INSTRUCTION
                };
                
                const aiMessage = await callGeminiAPI(payload);

                if (aiMessage !== null) {
                    conversationHistory.push({ role: 'model', parts: [{ text: aiMessage }] });
                    addMessage('ai', aiMessage);
                }

                sendButton.disabled = false;
                typingIndicator.classList.add('hidden');
                chatInput.focus();
            };
            
            // --- Feature: Optimize Text ---
            const handleOptimizeText = async () => {
                const textToOptimize = chatInput.value.trim();
                if (!textToOptimize) return;
                
                optimizeButton.disabled = true;
                optimizeIcon.classList.add('spinning');
                
                const prompt = `你是一位专业的沟通专家。请优化以下文本，使其表达更清晰、更专业、更礼貌。直接返回优化后的文本，不要添加任何额外的解释或引言。\n\n原文：\n"${textToOptimize}"`;
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const optimizedText = await callGeminiAPI(payload);
                
                if (optimizedText) {
                    chatInput.value = optimizedText;
                    chatInput.dispatchEvent(new Event('input'));
                }
                
                optimizeButton.disabled = false;
                optimizeIcon.classList.remove('spinning');
            };

            // --- Feature: Summarize Conversation ---
            const handleSummarize = async () => {
                if (conversationHistory.length < 1) {
                    addMessage('ai', '对话内容太少，还无法生成摘要。');
                    return;
                }

                summarizeButton.disabled = true;
                summarizeText.textContent = '正在总结...';

                const historyText = conversationHistory
                    .map(msg => `${msg.role === 'user' ? '用户' : 'AI'}: ${msg.parts[0].text}`)
                    .join('\n\n');
                
                const prompt = `你是一位专业的市场研究分析师。请根据以下对话记录，提炼出一份专业的研究摘要。摘要应识别关键洞察 (key insights)、用户痛点 (pain points)、潜在需求和情感倾向，并以结构化的要点形式呈现。\n\n对话记录：\n${historyText}`;
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const summary = await callGeminiAPI(payload);

                if (summary) {
                    addMessage('ai', summary, 'summary');
                }

                summarizeButton.disabled = false;
                summarizeText.textContent = '生成研究摘要';
            };

            // --- Function to clear chat ---
            const clearChat = () => {
                chatMessages.innerHTML = '';
                if (initialMessageContainer) {
                    chatMessages.appendChild(initialMessageContainer);
                    initialMessageContainer.style.display = 'block';
                }
                conversationHistory = [];
            }

            // --- Event Listeners ---
            sendButton.addEventListener('click', handleSendMessage);
            clearButton.addEventListener('click', clearChat);
            optimizeButton.addEventListener('click', handleOptimizeText);
            summarizeButton.addEventListener('click', handleSummarize);
            
            if (presetPrompts) {
                presetPrompts.addEventListener('click', (e) => {
                    const button = e.target.closest('.preset-btn');
                    if (button) {
                        const title = button.querySelector('h4').textContent;
                        const subtitle = button.querySelector('p').textContent;
                        const fullPrompt = `${title}：${subtitle}`;
                        chatInput.value = fullPrompt;
                        handleSendMessage();
                    }
                });
            }

            chatInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            });
            
            chatInput.addEventListener('input', () => {
                chatInput.style.height = 'auto';
                chatInput.style.height = (chatInput.scrollHeight) + 'px';
            });
        });
    </script>
</body>
</html>
